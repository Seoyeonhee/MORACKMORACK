<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FriendMapper">
 	
 	
	<resultMap id="friendSelectMap" type="friend">
		<result property="friendNo" 			column="friend_no" 			jdbcType="INTEGER"/>
		<result property="reqFriend.userId" 				column="req_friend_id" 					jdbcType="VARCHAR" />
		<result property="recvFriend.userId" 			column="recv_friend_id" 		jdbcType="VARCHAR" />
		<result property="friendCode" 				column="friend_code" 					jdbcType="CHAR" />
		<result property="reqFriendDate" 		column="req_friend_date" 			jdbcType="DATE" />
		<result property="friendDate"			column="friend_date"			jdbcType="DATE"/>
	</resultMap>
	
	<!-- SQL : INSERT -->
	<insert 	id="reqFriend"		parameterType="friend" >
	 	INSERT
	 	INTO	friend(		friend_no
	 					,	req_friend_id
	 					,	recv_friend_id
	 					,	friend_code
	 					,	req_friend_date
	 					,	friend_date
	 					) VALUES (	seq_friend_friend_no.nextval
	 							  ,	#{reqFriend.userId:VARCHAR2}
	 							  ,	#{recvFriend.userId:VARCHAR2}
	 							  ,	'0'
	 							  ,	sysdate
	 							  ,	null
	 							  )
	 					
	</insert>
	
	<select id="listRecvFriend" parameterType="map" resultMap="friendSelectMap">
		SELECT *
		FROM friend
		WHERE recv_friend_id=#{recvFriendId:VARCHAR2}
	</select>
	
	<select id="getRecvFriend" parameterType="String" resultMap="friendSelectMap">
		SELECT *
		FROM Friend
		WHERE req_friend_id = #{reqFriendId:VARCHAR}
	</select>
	
	<select id="listFriend" parameterType="map" resultMap="friendSelectMap">
		SELECT recv_friend_id, friend_date
		FROM friend
		WHERE req_friend_id=#{reqFriendId:VARCHAR}
	</select>	
	
	<select id="getFriend" parameterType="String" resultMap="friendSelectMap">
		SELECT *
		FROM friend
		WHERE recv_friend_id=#{recvFriendId:VARCHAR}
	</select>
	
	<update id="denyFriend" parameterType="friend">
		UPDATE friend
		<set>
			friend_code='2'
		</set>
		WHERE friend_no=#{friendNo:INTEGERE}
	</update>
	
	<update id="okFriend" parameterType="friend">
		UPDATE friend
		<set>
			friend_code='1'
		</set>
		WHERE friend_no=#{friendNo:INTEGER}
	</update>
	
	<insert id="okFriend" parameterType="friend">
		INSERT
		INTO friend	(		friend_no
						,	req_friend_id
						,	recv_friend_id
						,	friend_code
						,	req_friend_date
						,	friend_date
						)	VALUES (	seq_friend_friend_no.nextval
									,	#{recvFriendId.userId:VARCHAR}
									,	#{reqFriendId.userId:VARCHAR}
									,	'1'
									,	sysdate
									,	sysdate)
	
	</insert>
	
	<select id="getTotalCount"  parameterType="String"		resultType="int">
		SELECT COUNT(*)
		FROM (	
				SELECT *
				FROM	friend
				WHERE 	req_friend_if=#{reqFriendId}
				)
	</select>
	
</mapper>
		
		
		